<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dettagli Arduino Portenta H7</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Quicksand", sans-serif;
        }

        html, body {
            background: radial-gradient(circle, #111 0%, #222 50%, #000 100%);
            color: white;
            text-align: center;
            height: 100%;
            width: 100%;
            overflow: auto;
        }

        /* Contenitore globale con scroll snapping */
        .container {
            height: auto;
            width: 100%;
            overflow-y: auto;
            scroll-snap-type: none;
            /* Scroll fluido */
        }

        /* Sezioni che scorrono */
        .section {
            height: auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            scroll-snap-align: none;
            opacity: 1;
            transform: translateY(0);
            transition: none;
            padding: 20px 0;
        }

        /* Mantiene la presentazione iniziale centrata */
        .mirror-glass {
            width: 95%;
            max-width: 800px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
            border: 20px solid rgba(111, 91, 49, 1);
            margin-bottom: 20px;
        }

        /* Titolo con effetto riflesso */
        h1 {
            font-size: 3em;
            text-transform: uppercase;
            text-shadow: 0px 0px 10px rgba(255, 255, 255, 0.6);
            margin-bottom: 20px;
        }

        /* Testo secondario con effetto luminoso */
        p {
            font-size: 1.2em;
            opacity: 0.8;
            margin-bottom: 20px;
        }

        /* Footer */
        footer {
            background: black;
            color: white;
            height: auto;
            padding: 20px;
            margin-top: 20px;
        }

        /* Carousel */
        .carousel {
            position: relative;
            width: 100%;
            height: auto;
            overflow: visible;
            text-align: center;
            margin-bottom: 20px;
        }

        .carousel-inner {
            display: flex;
            flex-direction: column;
            transition: none;
            transform: translateY(0);
        }

        .carousel-item {
            flex: 0 0 auto;
            font-size: 1.5em;
            text-shadow: 0px 0px 10px rgba(255, 255, 255, 0.6);
            padding: 10px;
        }

        /* Stile per i bottoni */
        .buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            display: inline-block;
            padding: 15px 30px;
            background-color: #ffcc00;
            color: #111;
            text-decoration: none;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 5px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .btn:hover {
            background-color: #ffffff;
            color: #000;
        }

        /* Stile per la freccia animata */
        .scroll-down {
            position: relative;
            bottom: 0;
            right: 0;
            font-size: 2rem;
            color: #ffcc00;
            animation: none;
            cursor: pointer;
            z-index: 10;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <section class="section">
            <div class="mirror-glass">
                <h1>Arduino Portenta H7</h1>
                <p>Configurazione e dettagli del firmware</p>
                <div class="carousel">
                    <div class="carousel-inner">
                        <div class="carousel-item">Firmware</div>
                        <div class="carousel-item">Configurazione</div>
                        <div class="carousel-item">Dettagli</div>
                    </div>
                </div>
                <div class="buttons">
                    <a href="#" class="btn">Vai al firmware</a>
                    <a href="#" class="btn">Configura</a>
                </div>
                <a href="#" class="scroll-down">&#8681;</a>
            </div>
        </section>
        <section class="section">
            <div class="mirror-glass">
                <h2>Codice Firmware</h2>
                <p>
                    Questa sezione descrive il codice firmware caricato sull'Arduino Portenta H7 per la raccolta e la trasmissione
                    dei dati ambientali.
                </p>
                <div class="codice-container">
                    <pre><code>
#include &lt;WiFi.h&gt;
#include &lt;ArduinoHttpClient.h&gt;
#include "DHT.h"

const char* ssid = "YOUR_WIFI_SSID";
const char* password = "YOUR_WIFI_PASSWORD";
const char* serverIP = "YOUR_SERVER_IP";
const int serverPort = 80;
const char* httpEndpoint = "/your_endpoint.php";
#define DHTPIN 5
#define DHTTYPE DHT11

DHT dht(DHTPIN, DHTTYPE);
WiFiClient wifiClient;
HttpClient client = HttpClient(wifiClient, serverIP, serverPort);

void setup() {
  Serial.begin(115200);
  delay(1000);
  Serial.println("Connessione alla rete Wi-Fi...");
  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println("\nConnessione Wi-Fi stabilita!");
  Serial.print("Indirizzo IP: ");
  Serial.println(WiFi.localIP());
  dht.begin();
}

void loop() {
  float tempDHT = dht.readTemperature();
  float humDHT = dht.readHumidity();
  if (isnan(tempDHT) || isnan(humDHT)) {
    Serial.println("Errore durante la lettura del sensore DHT!");
  } else {
    String postData = "temp_dht=" + String(tempDHT, 1) + "&hum_dht=" + String(humDHT, 1);
    Serial.println("Invio dati al server...");
    Serial.println("Dati inviati: " + postData);
    client.post(httpEndpoint, "application/x-www-form-urlencoded", postData);
    int statusCode = client.responseStatusCode();
    String response = client.responseBody();
    Serial.print("Codice di stato HTTP: ");
    Serial.println(statusCode);
    Serial.print("Risposta dal server: ");
    Serial.println(response);
  }
  delay(60000);
}
                    </code></pre>
                </div>
            </div>
        </section>
        <section class="section">
            <div class="mirror-glass">
                <h2>Configurazione Raspberry Pi (Server)</h2>
                <p>
                    Questa sezione descrive la configurazione del Raspberry Pi per ricevere ed elaborare i dati inviati
                    dall'Arduino Portenta H7. Il Raspberry Pi funge da server e richiede l'installazione di un server web
                    (come Apache) e di PHP.
                </p>
                <p>
                    Il Raspberry Pi deve essere connesso alla stessa rete locale (LAN) dell'Arduino Portenta H7 per consentire
                    la comunicazione diretta. In questa configurazione, sia l'Arduino che il Raspberry Pi sono connessi alla stessa
                    rete fornita dalla VPN Tailscale. Questo permette all'Arduino di inviare i dati al Raspberry Pi,
                    anche se quest'ultimo si trova fisicamente in un'altra rete, grazie alla rete privata virtuale creata da Tailscale.
                </p>
                <h3>Comandi per configurare il Raspberry Pi:</h3>
                <ol>
                    <li>
                        Navigare nella directory del server web:
                        <pre><code>cd /var/www/html</code></pre>
                    </li>
                    <li>
                        Creare il file PHP per la gestione dei dati:
                        <pre><code>sudo nano forward_data.php</code></pre>
                    </li>
                    <li>
                        Inserire il seguente codice PHP nel file
                        <pre><code>forward_data.php</code></pre>:
                        <div class="codice-container">
                            <pre><code>
&lt;?php
session_start();

$buffer_interval = 5 * 60;
$current_time = time();

if (!isset($_SESSION['last_forwarding_time'])) {
    $_SESSION['last_forwarding_time'] = $current_time - $buffer_interval;
}

if (!isset($_SESSION['data_buffer'])) {
    $_SESSION['data_buffer'] = [];
}

if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['temp_dht'], $_POST['hum_dht'])) {
    $_SESSION['data_buffer'] = [
        'temp_dht' => $_POST['temp_dht'],
        'hum_dht' => $_POST['hum_dht'],
        'timestamp' => date('Y-m-d H:i:s', $current_time),
    ];
    echo "Dati ricevuti e aggiunti al buffer.\\n";
}

if ($current_time - $_SESSION['last_forwarding_time'] >= $buffer_interval) {
    if (!empty($_SESSION['data_buffer'])) {
        $post_data = http_build_query($_SESSION['data_buffer']);
        $url_save_data = "http://100.65.188.6:80/save_data.php";

        $ch = curl_init($url_save_data);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_POSTFIELDS, $post_data);
        curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-Type: application/x-www-form-urlencoded']);
        curl_setopt($ch, CURLOPT_TIMEOUT, 10);

        $response = curl_exec($ch);
        $http_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);
        $curl_error = curl_error($ch);
        curl_close($ch);

        if ($http_code >= 200 && $http_code < 300) {
            echo "Dati inoltrati con successo a save_data.php. Risposta: " . $response . "\\n";
        } else {
            echo "Errore nell'inoltro a save_data.php. Codice HTTP: " . $http_code . ", Errore cURL: " . $curl_code . ", Errore cURL: " . $curl_error . ", Risposta: " . $response . "\\n";
        }
    } else {
        echo "Nessun dato da inoltrare.\\n";
    }
    $_SESSION['last_forwarding_time'] = $current_time;
    $_SESSION['data_buffer'] = [];
} else {
    echo "Attesa del prossimo invio dati.\\n";
}
?&gt;
                        </code></pre>
                        </div>
                    </li>
                    <li>
                        Eseguire lo script per verificare il funzionamento:
                        <pre><code>php forward_data.php</code></pre>
                        <p>
                            Questo comando eseguirà lo script
                            <pre><code>forward_data.php</code></pre> direttamente dal terminale, permettendoti di vedere
                            eventuali errori o output. È utile per il debug e per assicurarsi che lo script funzioni come previsto.
                        </p>
                    </li>
                </ol>
                <p>
                    Il codice PHP mostrato gestisce i dati inviati dall'Arduino Portenta H7. I dati vengono memorizzati in una sessione
                    e inoltrati a un altro server (specificato dalla variabile
                    <pre><code>$url_save_data</code></pre>) ogni 5 minuti.
                    Questo approccio è utile per ridurre il carico sul server ricevente e per gestire eventuali interruzioni
                    nella connessione tra l'Arduino e il Raspberry Pi.
                </p>
            </div>
        </section>
        <footer>
            <p>Footer</p>
        </footer>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const sections = document.querySelectorAll(".section");

            // Intersection Observer per animare le sezioni quando diventano visibili
            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add("active");
                    }
                });
            }, {
                threshold: 0.5
            });

            sections.forEach(section => observer.observe(section));

            // ----------------------
            // Carousel verticale
            let currentIndex = 0;

            function updateCarousel() {
                const carouselInner = document.querySelector('.carousel-inner');
                const height = document.querySelector('.carousel').offsetHeight;
                carouselInner.style.transform = `translateY(-${currentIndex * height}px)`;
            }

            function nextSlide() {
                const items = document.querySelectorAll('.carousel-item');
                currentIndex = (currentIndex + 1) % items.length;
                updateCarousel();
            }

            function prevSlide() {
                const items = document.querySelectorAll('.carousel-item');
                currentIndex = (currentIndex - 1 + items.length) % items.length;
                updateCarousel();
            }

            // Auto-slide ogni 3 secondi
            setInterval(nextSlide, 3000);

            // Scroll verso la prossima sezione
            const scrollDownButtons = document.querySelectorAll('.scroll-down');

            scrollDownButtons.forEach((button, index) => {
                button.addEventListener('click', () => {
                    const sections = document.querySelectorAll('.section');
                    if (index + 1 < sections.length) {
                        sections[index + 1].scrollIntoView({
                            behavior: 'smooth'
                        });
                    }
                });
            });
        });
    </script>
</body>
</html>
